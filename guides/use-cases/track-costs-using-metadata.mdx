---
title: "Track Your LLM Costs Across Users, Teams, Projects, and More Using Portkey Metadata"
description: "Implement granular cost tracking across your entire LLM infrastructure with Portkey's metadata feature."
---
LLMs runs are costly. As you build more sophisticated applications, you need to track costs across different dimensions like users, teams, and workflows. You need to spend a lot of time setting up systems to track costs on a user level.
Consider these scenarios:

1. Your customer service automation serves thousands of users daily - how do you track costs per customer?
2. Your enterprise has multiple teams using LLMs - how do you allocate budgets effectively?
3. Your application has different features using LLMs - which ones are most cost-efficient?

Portkey's metadata feature allows you to tag every LLM request with custom attributes, enabling:

1. **User-level spend analysis** for customer billing
2. **Team/resource allocation** across departments
3. **Workflow optimization** by feature/use case
4. **Environment tracking** (prod vs staging) and more

This guide explains how to implement user-specific cost tracking, analyze costs in the Portkey dashboard, and access cost data programmatically via the analytics API.


**Let's get Started**

## Set Up Your Metadata for cost tracking
Portkey's Metadata feature allows you to tag requests with custom key-value pairs. This can later be used to filter your logs across different dimensions like users, teams, and workflows. You can pass any number of keys, all values should be of type string with max-length as 128 characters.

For this example let's track costs across different users, team and production environments. Here's how you can set up metadata for cost tracking:

Portkey's metadta acceps a JSON object of `key:value` paris to track your LLM requests. Here's how you will implement it in your LLM request:

<Note> **The `_user` field** is for built-in user analytics </Note>

<CodeGroup>

```python Python
# Python Implementation Example
from portkey import Portkey

portkey = Portkey(
    api_key="PORTKEY_API_KEY",
    virtual_key="OPENAI_VIRTUAL_KEY"
)

response = portkey.chat.completions.create(
    messages=[...],
    model="gpt-4",
    metadata={
        "_user": "customer_1",  # Special user identifier
        "team": "mobile_app_v2",
        "env": "production"
    }
)
```
```javascript NodeJS
import {Portkey} from 'portkey-ai'

const portkey = new Portkey({
    apiKey: "PORTKEY_API_KEY",
    virtualKey: "OPENAI_VIRTUAL_KEY"
})

const requestOptions = {
    metadata: {
        "_user": "USER_ID",
        "organisation": "ORG_ID",
        "request_id": "1729"
    }
}

const chatCompletion = await portkey.chat.completions.create({
    messages: [{ role: 'user', content: 'Who was ariadne?' }],
    model: 'gpt-4',
}, requestOptions);

console.log(chatCompletion.choices);
```

```sh cURL
curl https://api.portkey.ai/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "x-portkey-api-key: $PORTKEY_API_KEY" \
  -H "x-portkey-virtual-key: $OPENAI_VIRTUAL_KEY" \
  -H "x-portkey-metadata: {\"_user\":\"USER_ID\", \"organisation\":\"ORG_ID\", \"request_id\":\"1729\"}" \
  -d '{
    "model": "gpt-4",
    "messages": [{"role": "user","content": "Hello!"}]
  }'
```

</CodeGroup>

You can inject your application context into the metadata JSON object inside your application code.


## Analyzing Costs in Portkey Dashboard

### Live Cost Monitoring
1. Go to **Portkey Dashboard**
2. In the Searc Bar select the `>Meta`
3. Add metadata filters: `_user = customer_12345` (You can combine diffrent metadata filters to get a granular view of your LLM costs.)

<Frame>
    <img src="/images/guides/dashboard-metadata.png"/>
</Frame>

You can also set the `time range` to get a historical view of your costs.

## Use Portkey's Analytics API to track costs on Metadata

The Portkey Analytics API enables you to programmatically access your LLM cost and usage data for automation and system integration. While the dashboard provides excellent visual analytics, the API allows you to build custom solutions and integrate cost data directly into your existing systems.



### Understanding the Analytics API

The API provides comprehensive cost analytics data across any metadata dimension you've configured. You can query historical data, aggregate costs across different timeframes, and access detailed metrics for each metadata value.
Here's what you can access through the API:


```json
"data": [
  {
    "metadata_value": "kreacher",
    "requests": 4344632,
    "cost": 3887.3066999996863,
    "avg_tokens": 447.3689256075083,
    "avg_weighted_feedback": 4.2,
    "requests_with_feedback": 10,
    "last_seen": "2025-02-03T07:19:30.000Z",
    "object": "analytics-group"
  },
  {
    ...more such objects
  }
```

These metrics enable you to understand not just the costs, but also the usage patterns and efficiency of your LLM implementations.  For the scope of this guide we are interested in the `cost` metric. Here's how you can access this data programmatically using the Portkey Analytics API:

## Getting Started with the API

Before making your first API call, you'll need to obtain an API key from the Portkey Dashboard. This key requires analytics scope access, which you can configure in your API key settings.


<Note>
Here are the docs for the [Analytics API](/api-reference/admin-api/control-plane/analytics/groups-paginated-data/get-metadata-grouped-data)
</Note>

The API follows RESTful principles and accepts standard HTTP requests. Here's how to get started:

1. Replace the api key in the `x-portkey-api-key` header.
2. In the url replace `{metadataKey}` with the metadata key you want to track costs for.

<Note>
1. Portkey only sends a default number of list items in the response. You can get the complete list of repsonsee by setting the `page_size (Integer)` attribute in the request as the total number of list items you need.
2. If you need to add more filters to the request you can add them in the `metadata` field of the request body by passing strigfied  JSON with `{ "key": "value" }` pair.
</Note>

That's all you need to do the get the resonse data with the cost metric for the metadata key you are tracking.

<CodeGroup>

```js NodeJS
const options = {method: 'GET', headers: {'x-portkey-api-key': '<api-key>'}};

fetch('https://api.portkey.ai/v1/analytics/groups/metadata/{metadataKey}', options)
  .then(response => response.json())
  .then(response => console.log(response))
  .catch(err => console.error(err));

```

```py Python
import requests

url = "https://api.portkey.ai/v1/analytics/groups/metadata/{metadataKey}"

headers = {"x-portkey-api-key": "<api-key>"}

response = requests.request("GET", url, headers=headers)

print(response.text)

```

```sh cURL
curl --request GET \
  --url https://api.portkey.ai/v1/analytics/groups/metadata/{metadataKey} \
  --header 'x-portkey-api-key: <api-key>'
```

```java Java
HttpResponse<String> response = Unirest.get("https://api.portkey.ai/v1/analytics/groups/metadata/{metadataKey}")
  .header("x-portkey-api-key", "<api-key>")
  .asString();
```

```go GO
package main

import (
	"fmt"
	"net/http"
	"io/ioutil"
)

func main() {

	url := "https://api.portkey.ai/v1/analytics/groups/metadata/{metadataKey}"
	req, _ := http.NewRequest("GET", url, nil)
	req.Header.Add("x-portkey-api-key", "<api-key>")
	res, _ := http.DefaultClient.Do(req)
	defer res.Body.Close()
	body, _ := ioutil.ReadAll(res.Body)

	fmt.Println(res)
	fmt.Println(string(body))

}

```

```js PHP
<?php

$curl = curl_init();

curl_setopt_array($curl, [
  CURLOPT_URL => "https://api.portkey.ai/v1/analytics/groups/metadata/{metadataKey}",
  CURLOPT_RETURNTRANSFER => true,
  CURLOPT_ENCODING => "",
  CURLOPT_MAXREDIRS => 10,
  CURLOPT_TIMEOUT => 30,
  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
  CURLOPT_CUSTOMREQUEST => "GET",
  CURLOPT_HTTPHEADER => [
    "x-portkey-api-key: <api-key>"
  ],
]);

$response = curl_exec($curl);
$err = curl_error($curl);

curl_close($curl);

if ($err) {
  echo "cURL Error #:" . $err;
} else {
  echo $response;
}
```

</CodeGroup>


### Working with API Response Data
The API returns paginated results, with each page containing detailed metrics for different metadata values. You can use this data to:

- Create automated cost reports by aggregating data across different timeframes
- Monitor usage patterns and identify optimization opportunities
- Track cost allocation across teams or features
- Generate custom visualizations for stakeholder reporting

Many organizations integrate the Analytics API with their existing systems. For example:
- A customer service platform might pull cost data hourly to update their billing systems. The API's metadata grouping allows them to track costs per customer and automate usage-based billing.
- A product team might use the API to track costs across different features and optimize their LLM models based on usage patterns.


## Next Steps
1. [Set Up Budget Limit for your API Keys Thresholds](/product/ai-gateway/virtual-keys/budget-limits)
2. [How to set up fallbacks for your API requests](/product/ai-gateway/fallbacks)
3. [Portkey's Prompt management system](/product/prompt-library)

*Need enterprise-grade reporting? [Contact Sales](https://calendly.com/portkey-ai) for custom analytics solutions.*
