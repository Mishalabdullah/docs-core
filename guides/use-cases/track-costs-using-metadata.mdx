---
title: "Track your LLM costs across Users, Teams, Projects, and more using Portkey's Metadata"
description: "Implement granular cost tracking across your entire LLM infrastructure with Portkey's metadata feature."
---
LLMs runs are costly. As you build more sophisticated applications, you need to track costs across different dimensions like users, teams, and workflows. You need to spend a lot of time setting up systems to track costs on a user level.
Consider these scenarios:

1. Your customer service automation serves thousands of users daily - how do you track costs per customer?
2. Your enterprise has multiple teams using LLMs - how do you allocate budgets effectively?
3. How many $$$s are you spending on each feature inside your application?

Traditional solutions only offer API key-level tracking, requiring complex custom systems for granular analysis. Portkey's metadata feature solves this by enabling detailed cost tracking across your entire LLM infrastructure through custom request tagging.
1. **User-level spend analysis** for customer billing
2. **Team/resource allocation** across departments
3. **Workflow optimization** by feature/use case
4. **Environment tracking** (prod vs staging) and more

This guide explains how to implement user-specific cost tracking, analyze costs in the Portkey dashboard, and access cost data programmatically via the analytics API.



## Set Up Your Metadata for cost tracking
Portkey's metadata feature accepts custom key-value pairs with each request, enabling granular filtering across different dimensions. Each metadata value should be a string with a maximum length of 128 characters.

Here's how to implement metadata tracking for users, teams, and environments:

Portkey's metadata accepts a JSON object of `key:value` paris to track your LLM requests. Here's how you will implement it in your LLM request:

<Note> **The `_user` field** is for built-in user analytics </Note>

<CodeGroup>

```python Python
# Python Implementation Example
from portkey import Portkey

portkey = Portkey(
    api_key="PORTKEY_API_KEY",
    virtual_key="OPENAI_VIRTUAL_KEY"
)

response = portkey.chat.completions.create(
    messages=[...],
    model="gpt-4",
    metadata={
        "_user": "customer_1",  # Special user identifier
        "team": "mobile_app_v2",
        "env": "production"
    }
)
```
```javascript NodeJS
import {Portkey} from 'portkey-ai'

const portkey = new Portkey({
    apiKey: "PORTKEY_API_KEY",
    virtualKey: "OPENAI_VIRTUAL_KEY"
})

const requestOptions = {
    metadata: {
        "_user": "USER_ID",
        "organisation": "ORG_ID",
        "request_id": "1729"
    }
}

const chatCompletion = await portkey.chat.completions.create({
    messages: [{ role: 'user', content: 'Who was ariadne?' }],
    model: 'gpt-4',
}, requestOptions);

console.log(chatCompletion.choices);
```

```sh cURL
curl https://api.portkey.ai/v1/chat/completions \
  -H "Content-Type: application/json" \
  -H "x-portkey-api-key: $PORTKEY_API_KEY" \
  -H "x-portkey-virtual-key: $OPENAI_VIRTUAL_KEY" \
  -H "x-portkey-metadata: {\"_user\":\"USER_ID\", \"organisation\":\"ORG_ID\", \"request_id\":\"1729\"}" \
  -d '{
    "model": "gpt-4",
    "messages": [{"role": "user","content": "Hello!"}]
  }'
```

</CodeGroup>

Each metadata field in your request helps categorize and track costs. You can inject these values dynamically from your application context.


## Analyzing Costs in Portkey Dashboard

### Live Cost Monitoring
1. Go to **Portkey Dashboard**
2. In the Search Bar select the `>Meta`
3. Add metadata filters: `_user = customer_12345` (You can combine diffrent metadata filters to get a granular view of your LLM costs.)

<Frame>
    <img src="/images/guides/dashboard-metadata.png"/>
</Frame>

You can also set the `time range` to get a historical view of your costs.

## Use Portkey's Analytics API to track costs on Metadata

The Portkey Analytics API enables programmatic access to your LLM cost data, allowing you to build automated reporting systems and integrate with existing tools.



### Understanding the Analytics API

The API provides comprehensive cost analytics data across any metadata dimension you've configured. You can query historical data, aggregate costs across different timeframes, and access detailed metrics for each metadata value.
Here's what you can access through the API:


```json
"data": [
  {
    "metadata_value": "kreacher",
    "requests": 4344632,
    "cost": 3887.3066999996863,
    "avg_tokens": 447.3689256075083,
    "avg_weighted_feedback": 4.2,
    "requests_with_feedback": 10,
    "last_seen": "2025-02-03T07:19:30.000Z",
    "object": "analytics-group"
  },
  {
    ...more such objects
  }
```

These metrics provide insights into costs, usage patterns, and efficiency. The response includes:

- Total requests and costs per metadata value
- Average token usage for optimization analysis
- User feedback metrics for quality assessment
- Timestamp data for temporal analysis


## Getting Started with the API

Before making your first API call, you'll need to obtain an API key from the Portkey Dashboard. This key requires analytics scope access, which you can configure in your API key settings.


<Note>
Review the complete [Analytics API](/api-reference/admin-api/control-plane/analytics/groups-paginated-data/get-metadata-grouped-data) documentation for additional endpoints and features.
</Note>

The API follows RESTful principles and accepts standard HTTP requests. Here's how to get started:

1. Replace the api key in the `x-portkey-api-key` header.
2. In the url replace `{metadataKey}` with the metadata key you want to track costs for.

<Note>
- Use the `page_size` parameter to control the number of results per response
- Include additional filters by passing a stringified JSON object in the `metadata` field
</Note>

That's all you need to do the get the resonse data with the cost metric for the metadata key you are tracking.

<CodeGroup>

```js NodeJS
const options = {method: 'GET', headers: {'x-portkey-api-key': '<api-key>'}};

fetch('https://api.portkey.ai/v1/analytics/groups/metadata/{metadataKey}', options)
  .then(response => response.json())
  .then(response => console.log(response))
  .catch(err => console.error(err));

```

```py Python
import requests

url = "https://api.portkey.ai/v1/analytics/groups/metadata/{metadataKey}"

headers = {"x-portkey-api-key": "<api-key>"}

response = requests.request("GET", url, headers=headers)

print(response.text)

```

```sh cURL
curl --request GET \
  --url https://api.portkey.ai/v1/analytics/groups/metadata/{metadataKey} \
  --header 'x-portkey-api-key: <api-key>'
```

```java Java
HttpResponse<String> response = Unirest.get("https://api.portkey.ai/v1/analytics/groups/metadata/{metadataKey}")
  .header("x-portkey-api-key", "<api-key>")
  .asString();
```

```go GO
package main

import (
	"fmt"
	"net/http"
	"io/ioutil"
)

func main() {

	url := "https://api.portkey.ai/v1/analytics/groups/metadata/{metadataKey}"
	req, _ := http.NewRequest("GET", url, nil)
	req.Header.Add("x-portkey-api-key", "<api-key>")
	res, _ := http.DefaultClient.Do(req)
	defer res.Body.Close()
	body, _ := ioutil.ReadAll(res.Body)

	fmt.Println(res)
	fmt.Println(string(body))

}

```

```js PHP
<?php

$curl = curl_init();

curl_setopt_array($curl, [
  CURLOPT_URL => "https://api.portkey.ai/v1/analytics/groups/metadata/{metadataKey}",
  CURLOPT_RETURNTRANSFER => true,
  CURLOPT_ENCODING => "",
  CURLOPT_MAXREDIRS => 10,
  CURLOPT_TIMEOUT => 30,
  CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
  CURLOPT_CUSTOMREQUEST => "GET",
  CURLOPT_HTTPHEADER => [
    "x-portkey-api-key: <api-key>"
  ],
]);

$response = curl_exec($curl);
$err = curl_error($curl);

curl_close($curl);

if ($err) {
  echo "cURL Error #:" . $err;
} else {
  echo $response;
}
```

</CodeGroup>


### Working with API Response Data
The API returns paginated results, with each page containing detailed metrics for different metadata values. You can use this data to:

- Create automated cost reports by aggregating data across different timeframes
- Monitor usage patterns and identify optimization opportunities
- Track cost allocation across teams or features
- Generate custom visualizations for stakeholder reporting

Many organizations integrate the Analytics API with their existing systems. For example:
- A customer service platform might pull cost data hourly to update their billing systems. The API's metadata grouping allows them to track costs per customer and automate usage-based billing.
- A product team might use the API to track costs across different features and optimize their LLM models based on usage patterns.


## Next Steps
1. [Set Up Budget Limit for your API Keys Thresholds](/product/ai-gateway/virtual-keys/budget-limits)
2. [How to set up fallbacks for your API requests](/product/ai-gateway/fallbacks)
3. [Portkey's Prompt management system](/product/prompt-library)

*Need enterprise-grade reporting? [Contact Sales](https://calendly.com/portkey-ai) for custom analytics solutions.*
